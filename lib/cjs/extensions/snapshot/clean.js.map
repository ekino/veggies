{
  "version": 3,
  "sources": ["../../../../src/extensions/snapshot/clean.js"],
  "sourcesContent": ["'use strict'\n\n/**\n * @module extensions/snapshot/cleanup\n */\n\nimport * as snapshot from './snapshot.js'\nimport * as fileSystem from './fs.js'\nimport * as statistics from './statistics.js'\nimport { isEmpty, pick, omit } from '../../utils/index.js'\n\nexport let _snapshots = {}\n\n/**\n * Store a snapshot name for a snapshot file\n * This can be used after to clean up unused snapshots\n * @param {string} file - File path\n * @param {string} snapshotName - Snapshot name\n */\nexport const referenceSnapshot = function (file, snapshotName) {\n    _snapshots[file] = _snapshots[file] || []\n    _snapshots[file].push(snapshotName)\n}\n\n/**\n * Clean snapshots names and files\n * Used after tests to clear entries\n */\nexport const resetReferences = function () {\n    _snapshots = {}\n}\n\n/**\n * Clean snapshots file from removed snapshots\n * If a snapshot file is empty, it's deleted\n * Only files that have been referenced will be cleaned\n */\nexport const cleanSnapshots = function () {\n    Object.entries(_snapshots).forEach(([file, snapshotNames]) => {\n        if (isEmpty(snapshotNames)) {\n            fileSystem.remove(file)\n            return true\n        }\n\n        const content = snapshot.readSnapshotFile(file)\n        const newContent = pick(content, snapshotNames)\n        snapshot.writeSnapshotFile(file, newContent)\n\n        const omittedContent = omit(content, snapshotNames)\n        Object.entries(omittedContent).forEach(([snapshotName, _snapshotContent]) => {\n            statistics.removed.push({ file, name: snapshotName })\n        })\n    })\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA,eAA0B;AAC1B,iBAA4B;AAC5B,iBAA4B;AAC5B,mBAAoC;AAE7B,IAAI,aAAa,CAAC;AAQlB,MAAM,oBAAoB,SAAU,MAAM,cAAc;AAC3D,aAAW,IAAI,IAAI,WAAW,IAAI,KAAK,CAAC;AACxC,aAAW,IAAI,EAAE,KAAK,YAAY;AACtC;AAMO,MAAM,kBAAkB,WAAY;AACvC,eAAa,CAAC;AAClB;AAOO,MAAM,iBAAiB,WAAY;AACtC,SAAO,QAAQ,UAAU,EAAE,QAAQ,CAAC,CAAC,MAAM,aAAa,MAAM;AAC1D,YAAI,sBAAQ,aAAa,GAAG;AACxB,iBAAW,OAAO,IAAI;AACtB,aAAO;AAAA,IACX;AAEA,UAAM,UAAU,SAAS,iBAAiB,IAAI;AAC9C,UAAM,iBAAa,mBAAK,SAAS,aAAa;AAC9C,aAAS,kBAAkB,MAAM,UAAU;AAE3C,UAAM,qBAAiB,mBAAK,SAAS,aAAa;AAClD,WAAO,QAAQ,cAAc,EAAE,QAAQ,CAAC,CAAC,cAAc,gBAAgB,MAAM;AACzE,iBAAW,QAAQ,KAAK,EAAE,MAAM,MAAM,aAAa,CAAC;AAAA,IACxD,CAAC;AAAA,EACL,CAAC;AACL;",
  "names": []
}
